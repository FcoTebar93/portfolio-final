---
import "../styles/global.css";
import ThemeToggle from "../components/ThemeToggle.astro";
import LanguageToggle from "../components/LanguageToggle.astro";

interface Props {
    title: string;
}

const { title } = Astro.props;

let lang = 'en';
if (typeof window !== 'undefined') {
    const saved = localStorage.getItem('language');
    if (saved === 'es' || saved === 'en') {
        lang = saved;
    } else {
        const browserLang = navigator.language.split('-')[0];
        lang = browserLang === 'es' ? 'es' : 'en';
    }
}
---

<!doctype html>
    <html lang={lang}>
        <head>
            <meta charset="UTF-8" />
            <meta name="description" content="Francisco - Fullstack Developer Portfolio" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
            <link rel="preconnect" href="https://fonts.googleapis.com" />
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
            <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;700&display=swap"
            rel="stylesheet"
            />
            <title>{title}</title>
        </head>
        <body class="bg-primary text-text font-sans min-h-screen">
            <div id="app-container" class="app-container">
                <nav class="fixed top-0 right-0 p-4 z-50 flex gap-2 nav-container">
                    <ThemeToggle />
                    <LanguageToggle />
                </nav>
                <slot />
            </div>
            <div id="theme-clip" class="theme-clip" aria-hidden="true"></div>
        </body>
    </html>

<style>
    .app-container {
        min-height: 100vh;
    }

    .theme-clip {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
        z-index: 9999;
        overflow: hidden;
    }

    .theme-clip--anim {
        pointer-events: auto;
    }

    .theme-clip__inner {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        min-height: 100vh;
        background: var(--color-primary);
    }

    .theme-clip--anim .theme-clip__inner {
        will-change: clip-path;
        animation: theme-reveal 0.55s cubic-bezier(0.33, 1, 0.68, 1) forwards;
    }

    @keyframes theme-reveal {
        0% {
            clip-path: circle(0 at var(--clip-x, 50px) var(--clip-y, 50px));
        }
        100% {
            clip-path: circle(150vmax at var(--clip-x, 50px) var(--clip-y, 50px));
        }
    }

    .nav-container {
        background: transparent;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
        box-shadow: none;
        border: none;
    }

    [data-theme="light"] .nav-container {
        background: transparent;
    }
</style>